window.onload = () => {
  const webSocket = new WebSocket('<%= ws_url %>')
  const chat = document.querySelector('#chat')
  const chatForm = document.querySelector('#chat-form')
  const chatInput = document.querySelector('#chat-input')

  webSocket.onopen = () => console.log('#flump connected')
  webSocket.onclose = () => console.log('#flump disconnected')
  webSocket.onerror = error => console.error({ error })

  webSocket.onmessage = event => {
    const messageElement = document.createElement('div')
    messageElement.className = 'message'
    messageElement.innerText = event.data
    chat.appendChild(messageElement)
    messageElement.scrollIntoView()
  }

  chatForm.addEventListener('submit', event => {
    event.preventDefault()
    const message = chatInput.value
    webSocket.send(message)
    chatInput.value = ''
  })
}
